procs:
  user:
    shell: bash # if on Linux
    # shell: zsh # if on macOS
    stop: SIGKILL
  wscat:
    shell: |
      export $(cat .env | xargs)
      while ! nc -z localhost 3333; do
        echo "Waiting for fmcd to be ready..."
        sleep 1
      done
      echo "fmcd is up - executing wscat"
      wscat -c ws://localhost:3333/ws -H "Authorization: Bearer $FMCD_PASSWORD"
    stop: SIGTERM
  fmcd:
    shell: FMCD_MODE=ws cargo run --manifest-path ./Cargo.toml
    stop: SIGTERM
  ngrok:
    shell: |
      export $(cat .env | xargs)
      ngrok http $FMCD_ADDR
    stop: SIGTERM
